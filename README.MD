## Kawa Products API 
![](/assets/payetonkawaBanner.png)

## Participants üë•
- BILLARD M√©lissa
- BRACCIALES-COMBAS Lola
- CARRILHO LAMEIRA Rita
- DIAGNE Sokhna

## Technologie 
- Api en [FastApi](https://fastapi.tiangolo.com/)

## Base de donn√©es

[MySQL](https://www.mysql.com/fr/)

**Nom BDD** : ``product_db``

### Cr√©ation de la base de donn√©e
```python
## De la racine 
py database/scripts/create_BDD.py
```
![](/assets/create_bdd-2.png)

### Mock initial 
```
https://615f5fb4f7254d0017068109.mockapi.io/api/v1/products/
```
*Liste de donn√©es de tous les produits.*

![](/assets/mock.png)

### Mod√®le Conceptuel de Donn√©es (MCD)
![](/assets/MCD-3.png)

#### Mod√®le Logique de Donn√©es (MLD)
![](/assets/mld-3.png)

### D√©tails tables

#### Table `products`
- **id_product (INT, AUTO_INCREMENT, cl√© primaire)** : Identifiant unique pour chaque produit.
- **created_at (DATETIME, NOT NULL)** : Date et heure de cr√©ation du produit.
- **update_at (DATETIME)** : Date et heure de la derni√®re mise √† jour du produit.
- **name (VARCHAR(50), NOT NULL)** : Nom du produit.
- **price (DECIMAL(10, 2), NOT NULL)** : Prix du produit.
- **description (VARCHAR(150))** : Description du produit.
- **origin (VARCHAR(50), NOT NULL)** : Origine du produit (pays ou r√©gion d'origine).
- **UNIQUE(name)** : Contraintes d'unicit√© sur le nom du produit.

#### Table `stocks`
- **id_stocks (INT, AUTO_INCREMENT, cl√© primaire)** : Identifiant unique pour chaque enregistrement de stock.
- **quantity (INT, NOT NULL)** : Quantit√© en stock. Indique le nombre d'unit√©s disponibles pour le produit r√©f√©renc√©.
- **created_at (DATETIME)** : Date et heure de cr√©ation de l'enregistrement de stock.
- **update_at (DATETIME)** : Date et heure de la derni√®re mise √† jour de l'enregistrement de stock.
- **id_product (INT, NOT NULL)** : R√©f√©rence au produit. Ce champ fait le lien avec la table `products` en stockant l'identifiant du produit correspondant.
- **FOREIGN KEY(id_product)** : Cl√© √©trang√®re qui r√©f√©rence `id_product` dans la table `products`.

#### Table `categories`
- **id_category (INT, AUTO_INCREMENT, cl√© primaire)** : Identifiant unique pour chaque cat√©gorie.
- **name (VARCHAR(50), NOT NULL)** : Nom de la cat√©gorie.
- **description (VARCHAR(150))** : Description de la cat√©gorie.
- **id_product (INT, NOT NULL)** : R√©f√©rence au produit. Ce champ fait le lien avec la table `products` en stockant l'identifiant du produit correspondant.
- **UNIQUE(name)** : Contraintes d'unicit√© sur le nom de la cat√©gorie.
- **FOREIGN KEY(id_product)** : Cl√© √©trang√®re qui r√©f√©rence `id_product` dans la table `products`.

#### Table `suppliers`
- **id_supplier (INT, AUTO_INCREMENT, cl√© primaire)** : Identifiant unique pour chaque fournisseur.
- **name (VARCHAR(50), NOT NULL)** : Nom du fournisseur.
- **siret (VARCHAR(80), NOT NULL)** : Num√©ro SIRET du fournisseur.
- **address (VARCHAR(150))** : Adresse du fournisseur.
- **email (VARCHAR(50))** : Adresse e-mail du fournisseur.
- **phone (VARCHAR(50))** : Num√©ro de t√©l√©phone du fournisseur.
- **created_at (DATETIME, NOT NULL)** : Date et heure de cr√©ation de l'enregistrement.
- **update_at (DATETIME)** : Date et heure de la derni√®re mise √† jour.
- **UNIQUE(name)** : Contrainte d'unicit√© sur le nom du fournisseur.
- **UNIQUE(siret)** : Contrainte d'unicit√© sur le num√©ro SIRET du fournisseur.

#### Table `product_suppliers`
- **id_product (INT, NOT NULL)** : R√©f√©rence au produit. Ce champ fait le lien avec la table `products` en stockant l'identifiant du produit correspondant.
- **id_supplier (INT, NOT NULL)** : R√©f√©rence au fournisseur. Ce champ fait le lien avec la table `suppliers` en stockant l'identifiant du fournisseur correspondant.
- **PRIMARY KEY (id_product, id_supplier)** : Cl√© primaire composite qui assure l'unicit√© des paires produit-fournisseur.
- **FOREIGN KEY(id_product)** : Cl√© √©trang√®re qui r√©f√©rence `id_product` dans la table `products`.
- **FOREIGN KEY(id_supplier)** : Cl√© √©trang√®re qui r√©f√©rence `id_supplier` dans la table `suppliers`.

## Endpoints de l'API
![](/assets/ed-1.png)
![](/assets/ed-2.png)
![](/assets/ed-3.png)

## Docker

1) Build container : ```docker-compose build```

2) Start container : ```docker-compose up```

3) Create network : ```docker network create kawa-shared-network```

## Commandes utiles

### Lancer l'api en local
```python
# Dans le fichier app
fastapi dev main.py
# ou
# √Ä la racine
 uvicorn app.main:app --reload
```

### Effacer fichiers DS_Store
```java
find . -name .DS_Store -print0 | xargs -0 git rm -f --ignore-unmatch
```
## Tests
Librairie utilis√© : [unittest](https://docs.python.org/3/library/unittest.html)
```python
pip install fastapi requests sqlalchemy
```

Ex√©cuter les tests : 
```python
python -m unittest tests/test_api.py
```
### Tests unitaires et d'int√©gration

![](/assets/test-ok.png)

| **Nom du Test**                              | **Description**                                                | **Type**          |
|---------------------------------------------|----------------------------------------------------------------|-------------------|
| `test_connection`                          | Teste la connexion √† la base de donn√©es.                       | Unitaire       |
| `test_table_exists`                        | V√©rifie que la table sp√©cifi√©e existe dans la base de donn√©es. | Unitaire       |
| `test_insert`                              | Teste l'insertion de donn√©es dans la table sp√©cifi√©e.          | Int√©gration       |
| `test_read`                                | Teste la lecture des donn√©es dans la table sp√©cifi√©e.          | Unitaire       |
| `test_update`                              | Teste la mise √† jour des donn√©es dans la table sp√©cifi√©e.      | Int√©gration       |
| `test_delete`                              | Teste la suppression de donn√©es dans la table sp√©cifi√©e.       | Int√©gration       |
| `test_table_products_exists`              | V√©rifie que la table `products` existe dans la base de donn√©es. | Unitaire          |
| `test_table_stocks_exists`                | V√©rifie que la table `stocks` existe dans la base de donn√©es.   | Unitaire          |
| `test_table_categories_exists`            | V√©rifie que la table `categories` existe dans la base de donn√©es. | Unitaire          |
| `test_table_suppliers_exists`             | V√©rifie que la table `suppliers` existe dans la base de donn√©es. | Unitaire          |
| `test_table_product_suppliers_exists`     | V√©rifie que la table `product_suppliers` existe dans la base de donn√©es. | Unitaire          |
| `test_insert_into_products`                | Teste l'insertion de donn√©es dans la table `products`.          | Int√©gration       |
| `test_read_from_products`                  | Teste la lecture des donn√©es dans la table `products`.          | Unitaire       |
| `test_update_products`                     | Teste la mise √† jour des donn√©es dans la table `products`.      | Int√©gration       |
| `test_delete_from_products`                | Teste la suppression de donn√©es dans la table `products`.       | Int√©gration       |

#### Rapport de test en format XML
```python
pytest --junitxml=report.xml
```
#### Rapport de test en format HTML
```python
coverage run -m unittest discover
coverage report
coverage html
```
![](/assets/coverage.png)
